## MLOPS PLAY GROUND

Репозиторий для понимания, что из себя представляет mlops процесс,

Пример как  

Хранение и версионирования большого объема данных собранных данных.
Мониторинг, метрика и хранение обученных моделей.

Пример содержит


- [DVC](https://dvc.org)   - система версионирования данных.

- [MlFlow](https://www.mlflow.org) - Мониторинга метрик моделей, хранение моделей, версионирование моделей

- [Minio](https://min.io/) - хранилеще с s3 api интерфейсом. Является общей зависимостью перечисленных выше компонентов 

- [Docker](https://www.docker.com/) - общая обвязка, что бы быстро поднять все сконфигрурированые компоненты

- [make]()   - Все команды идут через него. Что бы вас не мучать. 


#### 1 Поднять всё окружение
```bash
make up
```

Команда запустит в докерах Minio хранилище.
Создаст там бакеты для данных и моделей.
Поднимет базу данных для MLFlow
Соберёт образ mlflow-server и запустит его.

После запуска  сервисы должны быть доступны по слудющим адресам:

[MlFlow](http://127.0.0.1:5000)

[Minio](http://127.0.0.1:9000)

Логин  root

Пароль password

#### 2 DVC
Если знакомы с процессом инициализации dvc, можете пропустить этот шаг.
Если нет, тогда удалите .dvc директорию
```bash
rm -rf .dvc/
```

и запустите 
```bash
make .dvc
```

Скрипт сконфигурирует dvc с доступом в хранилище Minio

Подробная конфигурация описана [тут](scripts/dvc_init.sh)

#### 3. Получаем данные из внешнего источника.

На самом деле, получения данных может быть более трудоемким процессом из нескольких баз,
   с использованием сложных запросов. Что бы это опустить, представим, что мы уже вытащили данные в csv.
```bash
make data/data.csv
```

Данная команда соберёт data/data.csv
и проиндексирует его через dvc
подробнее [тут](scripts/lessons_get_test_data.sh)

Далее заиндексируйту dvc файлы с описанием через git

```bash
    git add data/data.csv.dvc data/.gitignore
```
Обратите внимение, что в git заиндекисровали только файлы с ссылками на данные, но не сами данные.

#### 4. Отправка данных в сторадж
```bash
    dvc push
```

После запуска команды dvc отправит данные в minio
данные должны появить в [этом бакете](http://127.0.0.1:9000/minio/github.com/yakovlachin/mlops/data)

Теперь, можете попробовать удалить  данные и запулить их из стораджа
```bash
    rm data/data.csv
    dvc pull
```

#### 5. Запуск модели
На текущий момент рассмотрим пример из учебных данны
Скрипт тренировки модели находится [тут]()

Установите зависимости и запустите

```bash
python model.py
```

Выше стандартный скрипт для обучения нейронной сети, но с метриками mlflow
Обратите внемание, что в скрипте явно указаны переменные окружения, что бы было понимание,
каким образом mlflow находит хранилище и сервис метрик.
